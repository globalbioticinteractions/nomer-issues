[{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/772637146","html_url":"https://github.com/globalbioticinteractions/nomer/issues/31#issuecomment-772637146","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/31","id":772637146,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MjYzNzE0Ng==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-03T16:26:11Z","updated_at":"2021-02-03T16:26:11Z","body":"@nleguillarme great to hear that you are starting to use concurrent requests! Can you please share code that you use to invoke the concurrent requests? Ideally, I'd like to be able to reproduce the issue independently, so I can see whether a proposed fix works as designed. ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/772637146/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/772679838","html_url":"https://github.com/globalbioticinteractions/nomer/issues/31#issuecomment-772679838","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/31","id":772679838,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MjY3OTgzOA==","user":{"login":"nleguillarme","id":44698109,"node_id":"MDQ6VXNlcjQ0Njk4MTA5","avatar_url":"https://avatars.githubusercontent.com/u/44698109?v=4","gravatar_id":"","url":"https://api.github.com/users/nleguillarme","html_url":"https://github.com/nleguillarme","followers_url":"https://api.github.com/users/nleguillarme/followers","following_url":"https://api.github.com/users/nleguillarme/following{/other_user}","gists_url":"https://api.github.com/users/nleguillarme/gists{/gist_id}","starred_url":"https://api.github.com/users/nleguillarme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nleguillarme/subscriptions","organizations_url":"https://api.github.com/users/nleguillarme/orgs","repos_url":"https://api.github.com/users/nleguillarme/repos","events_url":"https://api.github.com/users/nleguillarme/events{/privacy}","received_events_url":"https://api.github.com/users/nleguillarme/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-03T17:22:33Z","updated_at":"2021-02-03T17:23:55Z","body":"@jhpoelen\r\n\r\nClone pynomer's repo and install pynomer :\r\n`git clone https://github.com/nleguillarme/pynomer.git`\r\n`cd pynomer`\r\n`python setup.py sdist ; pip install dist/pynomer-0.1.6.tar.gz`\r\n\r\nBuild the docker image :\r\n`docker build -t pynomer-server -f Dockerfile.gunicorn .`\r\n\r\nStart the server :\r\n`docker run -v${PWD}/.nomer:/pynomer/.nomer -v${PWD}/logs:/logs -p 8180:8180 pynomer-server`\r\n\r\nIn another terminal, run the attached script test_pynomer.py\r\n`python test_pynomer.py`\r\n\r\nYou should see a bunch of \"using matcher [globi-taxon-cache]\" logs in the server terminal, and from time to time the Lucene exception.\r\n\r\n[taxons.csv.txt](https://github.com/globalbioticinteractions/nomer/files/5920308/taxons.csv.txt)\r\n[test_pynomer.py.txt](https://github.com/globalbioticinteractions/nomer/files/5920309/test_pynomer.py.txt)\r\n\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/772679838/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/773637907","html_url":"https://github.com/globalbioticinteractions/nomer/issues/31#issuecomment-773637907","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/31","id":773637907,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MzYzNzkwNw==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-04T22:13:42Z","updated_at":"2021-02-04T22:13:42Z","body":"@nleguillarme thanks for providing the extra info. \r\n\r\nThe likely root cause is multiple nomer instances trying to rebuild a search index locally at the same location. \r\n\r\nAs I am working on a fix, a workaround is to resolve one term using one nomer instance first. Only after nomer is initialized automatically before the first term is resolved, start the massively paralell operation. Alternatively, you can start separate nomer instances using different cache dirs.\r\n\r\nThanks again for reporting this issue and I hope to get to it sooner rather than later.  \r\n\r\nPS Why not use ```parallel``` (https://opensource.com/article/18/5/gnu-parallel) to do parallel resolving of terms?\r\n\r\n```\r\n$ cat taxa.tsv | parallel nomer append > taxon-matches.tsv\r\n```","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/773637907/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/774031917","html_url":"https://github.com/globalbioticinteractions/nomer/issues/31#issuecomment-774031917","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/31","id":774031917,"node_id":"MDEyOklzc3VlQ29tbWVudDc3NDAzMTkxNw==","user":{"login":"nleguillarme","id":44698109,"node_id":"MDQ6VXNlcjQ0Njk4MTA5","avatar_url":"https://avatars.githubusercontent.com/u/44698109?v=4","gravatar_id":"","url":"https://api.github.com/users/nleguillarme","html_url":"https://github.com/nleguillarme","followers_url":"https://api.github.com/users/nleguillarme/followers","following_url":"https://api.github.com/users/nleguillarme/following{/other_user}","gists_url":"https://api.github.com/users/nleguillarme/gists{/gist_id}","starred_url":"https://api.github.com/users/nleguillarme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nleguillarme/subscriptions","organizations_url":"https://api.github.com/users/nleguillarme/orgs","repos_url":"https://api.github.com/users/nleguillarme/repos","events_url":"https://api.github.com/users/nleguillarme/events{/privacy}","received_events_url":"https://api.github.com/users/nleguillarme/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-05T13:26:19Z","updated_at":"2021-02-05T13:26:19Z","body":"> The likely root cause is multiple nomer instances trying to rebuild a search index locally at the same location.\r\n\r\nI don't think this is the cause of the problem. I've just checked by building the index first, then starting the threads (the server having access to the built index in the .nomer directory), and I still have the LockObtainFailedException. I am wondering why nomer tries to obtain a write lock at query time ? Does it have to write something in the index at each query ?\r\n\r\n> PS Why not use `parallel` (https://opensource.com/article/18/5/gnu-parallel) to do parallel resolving of terms?\r\n\r\nI didn't know about GNU Parallel, I'll take a look at it, thanks.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/774031917/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/774191050","html_url":"https://github.com/globalbioticinteractions/nomer/issues/31#issuecomment-774191050","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/31","id":774191050,"node_id":"MDEyOklzc3VlQ29tbWVudDc3NDE5MTA1MA==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-05T17:58:54Z","updated_at":"2021-02-05T17:58:54Z","body":"@nleguillarme glad to hear that using ```parallel``` looks promising for what you are trying to do.\r\n\r\nAnd, yes, you were right that the write lock occurs even at query time, after building the index. I reproduced and fixed the issue and hoping to release a new nomer version soon. Thanks for being patient.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/774191050/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/776895178","html_url":"https://github.com/globalbioticinteractions/nomer/issues/31#issuecomment-776895178","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/31","id":776895178,"node_id":"MDEyOklzc3VlQ29tbWVudDc3Njg5NTE3OA==","user":{"login":"nleguillarme","id":44698109,"node_id":"MDQ6VXNlcjQ0Njk4MTA5","avatar_url":"https://avatars.githubusercontent.com/u/44698109?v=4","gravatar_id":"","url":"https://api.github.com/users/nleguillarme","html_url":"https://github.com/nleguillarme","followers_url":"https://api.github.com/users/nleguillarme/followers","following_url":"https://api.github.com/users/nleguillarme/following{/other_user}","gists_url":"https://api.github.com/users/nleguillarme/gists{/gist_id}","starred_url":"https://api.github.com/users/nleguillarme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nleguillarme/subscriptions","organizations_url":"https://api.github.com/users/nleguillarme/orgs","repos_url":"https://api.github.com/users/nleguillarme/repos","events_url":"https://api.github.com/users/nleguillarme/events{/privacy}","received_events_url":"https://api.github.com/users/nleguillarme/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-10T17:51:16Z","updated_at":"2021-02-10T17:51:16Z","body":"It turned out that I didn't even need parallel, as I use Apache Airflow which already has some mechanisms to run tasks in parallel.\r\nWhat has considerably accelerated the matching process is batch query processing, i.e. the ability to ask for several taxons at once using the \"cat taxa.tsv | nomer\" mechanism. I didn't know it was possible, and it's a real life saver ;)","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/776895178/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/780091407","html_url":"https://github.com/globalbioticinteractions/nomer/issues/31#issuecomment-780091407","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/31","id":780091407,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MDA5MTQwNw==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-16T20:16:07Z","updated_at":"2021-02-16T20:16:07Z","body":"@nleguillarme I released a new version of nomer v0.1.23 for fix for the Lucene lock issue you reported  at https://github.com/globalbioticinteractions/nomer/releases/tag/0.1.23 . \r\n\r\nThanks for being patient and let me know if your issue has been resolved.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/780091407/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/790151727","html_url":"https://github.com/globalbioticinteractions/nomer/issues/31#issuecomment-790151727","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/31","id":790151727,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MDE1MTcyNw==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-03T23:36:12Z","updated_at":"2021-03-03T23:36:25Z","body":"@nleguillarme did you get a chance to confirm that the lucene lock timeout has been resolved for you? If I don't hear from you in the next weeks, I assume that the issue has been resolved. Thanks for being patient.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/790151727/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]