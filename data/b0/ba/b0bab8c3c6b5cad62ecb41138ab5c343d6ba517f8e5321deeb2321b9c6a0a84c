[{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387816805","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-387816805","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":387816805,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NzgxNjgwNQ==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-09T17:36:36Z","updated_at":"2018-05-09T17:36:36Z","body":"@cboettig thanks for sharing. Your comments highlight various separate issues. I'll attempt to address each of them separately in the following comments. I am planning to release a new GloBI Taxon Graph version v0.3.2 with corrections applied in this thread.\r\n\r\nFirst, in line 98457 in taxonCache.tsv v0.3.1, I found (please note that header was added for convenience)\r\n\r\n```tsv\r\nid      name    rank    commonNames     path    pathIds pathNames       externalUrl     thumbnailUrl\r\nEOL:224784      Neoniphon sammara       Species \"Kolvin-soldaat @af | Deek @ar | 鐵甲 @cnm | Eichhörnchenfisch @de | Sammara squirrelfish @en | Candil samara @es | Corocoro @fj | Marignan tacheté @fr | \\\"Ala'ihi @hw | Ukeguchi-ittoudai @ja | 무늬얼게돔 @ko | Jerra @mh | Kolithaduva @ml | Kinolu @ms | Esquilo samara @pt | Malau-tui @sm | Baga-baga @tl | Araoe @ty | Cá Son dá dài @vi | 条纹长颏鳂 @zh | 莎姆新東洋金鱗魚 @zh-Hant |\"        Animalia | Chordata | Actinopterygii | Beryciformes | Holocentridae | Neoniphon | Neoniphon sammara     EOL:1 | EOL:694 | EOL:1905 | EOL:8234 | EOL:8237 | EOL:24504 | EOL:224784       kingdom | phylum | class | order | family | genus | species     http://eol.org/pages/224784     http://media.eol.org/content/2009/05/19/16/85885_98_68.jpg\r\n```\r\nNote that commonNames value is (incorrectly) enclosed by double quotes and an escaped \\\"Ala'ihi @hw\r\n\r\nOn closer inspection, the commonNames value was enclosed by quotes when csv was still used to store taxonCache. This also explains the escaped double quote. Also, it appears that the Hawaiian name for _Neoniphon sammara_ is not transcribed properly in EOL http://eol.org/pages/224784/names/common_names . Instead of ```\"Ala'ihi```, I suspect the name should be ```'ala'ihi```, replacing the double quotes with a single quote.\r\n\r\n@jhammock any change you can update the common name? From sources like http://www.wpcouncil.org/managed-fishery-ecosystems/hawaii-archipelago/regulations-and-enforcement-hawaii/ it appears that the common name is used to describe various different species, not just  _Neoniphon sammara_ .\r\n\r\nTo correct for this, double quotes are removed and the escape double quote has been replaced with the original string reported by EOL, including the double quotes. Note that TSV does not need escaping of quotes (https://www.iana.org/assignments/media-types/text/tab-separated-values) .\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387816805/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387819123","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-387819123","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":387819123,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NzgxOTEyMw==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-09T17:44:27Z","updated_at":"2018-05-09T17:44:27Z","body":"A second issue was reported on line 119858:\r\n\r\n```\r\nid\tname\trank\tcommonNames\tpath\tpathIds\tpathNames\texternalUrl\tthumbnailUrl\r\nEOL:392765\tHandroanthus chrysanthus\tSpecies\t\"roble amarillo @en | \\\"makulis\\\" @es | เหลืองอินเดีย @th |\"\tPlantae | Tracheophyta | Magnoliopsida | Lamiales | Bignoniaceae | Handroanthus | Handroanthus chrysanthus\tEOL:281 | EOL:4077 | EOL:283 | EOL:4300 | EOL:4421 | EOL:27931337 | EOL:392765\tkingdom | phylum | class | order | family | genus | species\thttp://eol.org/pages/392765\thttp://media.eol.org/content/2015/02/26/03/48029_98_68.jpg\r\n```\r\n\r\nSimilar pattern is observed here: csv-style escaping/quoting used because of the usage of double quotes in the text.\r\n\r\n@jhammock any idea why ```makulis``` for spanish common name on http://eol.org/pages/392765/names/common_names is surrounded by double quotes?\r\n\r\nTo correct, doubles quotes are removed as well as the escaped double quotes. ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387819123/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387821272","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-387821272","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":387821272,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NzgyMTI3Mg==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-09T17:51:49Z","updated_at":"2018-05-09T17:51:49Z","body":"A third issue was reported on line 425504:\r\n\r\n```\r\nid\tname\trank\tcommonNames\tpath\tpathIds\tpathNames\texternalUrl\tthumbnailUrl\r\nINAT_TAXON:379688\tcandidatus phytoplasma\tgenus\t\t\"Bacteria | Firmicutes | Mollicutes | \\\"candidatus phytoplasma\\\"\"\tINAT_TAXON:67333 | INAT_TAXON:151853 | INAT_TAXON:151986 | INAT_TAXON:379688\tkingdom | phylum | class | genus\thttp://inaturalist.org/taxa/379688\t\r\n```\r\nSame double quoting issues here. integration tests confirm that iNaturalist explicitly reports ```\"candidatus phytoplasma\"``` for the genus. \r\nTo correct, enclosing double quotes are removed as well as the escape characters. ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387821272/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387823328","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-387823328","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":387823328,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NzgyMzMyOA==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-09T17:58:16Z","updated_at":"2018-05-09T17:58:16Z","body":"A fourth issue was found, where entries in taxonCache were found without a taxonId column. This was a transformation mistake and entries with missing taxonId columns will be removed. Note that the entries without an id actually had valid counter parts in the taxonCache file. ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387823328/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387826842","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-387826842","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":387826842,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NzgyNjg0Mg==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-09T18:09:19Z","updated_at":"2018-05-09T18:09:53Z","body":"Also, please note that the first three issues are definitely data errors, but not tsv parsing errors. TSV, according to IANA https://www.iana.org/assignments/media-types/text/tab-separated-values , does not have any string quoting . Please see https://github.com/tidyverse/readr/issues/844 . \r\n\r\nIf empty quote parameter is used, no problems are encountered when reading the taxonCache.tsv : \r\n\r\n```R\r\ntaxonCache <- readr::read_tsv('taxonCache.tsv', quote='')\r\nParsed with column specification:\r\ncols(\r\n  id = col_character(),\r\n  name = col_character(),\r\n  rank = col_character(),\r\n  commonNames = col_character(),\r\n  path = col_character(),\r\n  pathIds = col_character(),\r\n  pathNames = col_character(),\r\n  externalUrl = col_character(),\r\n  thumbnailUrl = col_character()\r\n)\r\n|=================================================================| 100%  904 MB\r\n> library(readr)\r\n> problems(taxonCache)\r\n# tibble [0 × 4]\r\n# ... with 4 variables: row <int>, col <int>, expected <chr>, actual <chr>\r\n```\r\n@cboettig curious to hear your thoughts on all this.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387826842/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387858579","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-387858579","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":387858579,"node_id":"MDEyOklzc3VlQ29tbWVudDM4Nzg1ODU3OQ==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-09T20:03:27Z","updated_at":"2018-05-09T20:03:27Z","body":"I've prepared a pre-release of taxonCache with applied changes, please see https://depot.globalbioticinteractions.org/tmp/taxon-0.3.2/taxonCache.tsv.gz . Please let me know if this pre-release solves this issue. If not, or if you find new issue, please do share.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387858579/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387861292","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-387861292","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":387861292,"node_id":"MDEyOklzc3VlQ29tbWVudDM4Nzg2MTI5Mg==","user":{"login":"cboettig","id":222586,"node_id":"MDQ6VXNlcjIyMjU4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/222586?v=4","gravatar_id":"","url":"https://api.github.com/users/cboettig","html_url":"https://github.com/cboettig","followers_url":"https://api.github.com/users/cboettig/followers","following_url":"https://api.github.com/users/cboettig/following{/other_user}","gists_url":"https://api.github.com/users/cboettig/gists{/gist_id}","starred_url":"https://api.github.com/users/cboettig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cboettig/subscriptions","organizations_url":"https://api.github.com/users/cboettig/orgs","repos_url":"https://api.github.com/users/cboettig/repos","events_url":"https://api.github.com/users/cboettig/events{/privacy}","received_events_url":"https://api.github.com/users/cboettig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-09T20:13:11Z","updated_at":"2018-05-09T20:13:11Z","body":"Thanks, will do!  Good point on the `tsv` by the way; makes total sense. The whole escaped quoting thing in `csv` files always bugged me, so `tsv` is a pretty clever solution I never properly appreciated (since it's harder to imagine needing a literal `\\t` in a text file, but easy to see why you need a literal `,`)\r\n\r\nQuick clarification on the entities that didn't have valid ids and were thus creating the alignment problems: so those rows were duplicates of rows already elsewhere in taxonCache?  Are those rows now dropped from the table?  \r\n\r\nI'm playing a bit with parsing the pipe strings right now; I see there utility but I think it would often be convenient to have a more explicit relationship between rank, value, and id in those strings.  Will let you know if that surfaces any other parsing issues for me.  ","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387861292/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387864502","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-387864502","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":387864502,"node_id":"MDEyOklzc3VlQ29tbWVudDM4Nzg2NDUwMg==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-09T20:25:06Z","updated_at":"2018-05-09T20:25:18Z","body":"> Quick clarification on the entities that didn't have valid ids and were thus creating the alignment problems: so those rows were duplicates of rows already elsewhere in taxonCache? Are those rows now dropped from the table?\r\n\r\nI did some spot checks, and duplicates seem to exist. I removed the entries with path values that include the unexpected ```:``` delimited values.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387864502/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387866472","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-387866472","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":387866472,"node_id":"MDEyOklzc3VlQ29tbWVudDM4Nzg2NjQ3Mg==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-09T20:32:18Z","updated_at":"2018-05-09T20:32:47Z","body":">  I see there utility but I think it would often be convenient to have a more explicit relationship between rank, value, and id in those strings. \r\n\r\nI agree that zipping (combining) path / pathIds / pathNames is not convenient. It seems that most biologist are comfortable with tabular formats, so I am trying to figure out ways to mold data into that shape to lower barrier to edit / use / share without losing too much flexibility. Am open to suggestions and am in favor of exposing the same knowledge in different formats rather than taking a one-size-fits-all approach.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387866472/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387874395","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-387874395","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":387874395,"node_id":"MDEyOklzc3VlQ29tbWVudDM4Nzg3NDM5NQ==","user":{"login":"cboettig","id":222586,"node_id":"MDQ6VXNlcjIyMjU4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/222586?v=4","gravatar_id":"","url":"https://api.github.com/users/cboettig","html_url":"https://github.com/cboettig","followers_url":"https://api.github.com/users/cboettig/followers","following_url":"https://api.github.com/users/cboettig/following{/other_user}","gists_url":"https://api.github.com/users/cboettig/gists{/gist_id}","starred_url":"https://api.github.com/users/cboettig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cboettig/subscriptions","organizations_url":"https://api.github.com/users/cboettig/orgs","repos_url":"https://api.github.com/users/cboettig/repos","events_url":"https://api.github.com/users/cboettig/events{/privacy}","received_events_url":"https://api.github.com/users/cboettig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-09T21:01:05Z","updated_at":"2018-05-09T21:01:05Z","body":"@jhpoelen I think I'm still seeing a whole bunch of entries with alignment issues?\r\n\r\n```r\r\nlibrary(tidyverse)\r\ntaxonCache <- read_tsv(\"https://depot.globalbioticinteractions.org/tmp/taxon-0.3.2/taxonCache.tsv.gz\", quote=\"\")\r\n\r\ntaxonCache %>% filter(!grepl(\"(:|-|_)\", id)) \r\n```\r\n\r\nshows a bunch of rows that are getting parsed that appear to have no id and so still have everything miss-aligned.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387874395/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387901406","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-387901406","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":387901406,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NzkwMTQwNg==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-09T23:06:52Z","updated_at":"2018-05-09T23:10:06Z","body":"@cboettig confirmed . I've uploaded a second pass at the taxonCach.tsv.gz file, overwriting https://depot.globalbioticinteractions.org/tmp/taxon-0.3.2/taxonCache.tsv.gz . Thanks for sharing, please check and  let me know if you see more issues.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387901406/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387942117","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-387942117","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":387942117,"node_id":"MDEyOklzc3VlQ29tbWVudDM4Nzk0MjExNw==","user":{"login":"cboettig","id":222586,"node_id":"MDQ6VXNlcjIyMjU4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/222586?v=4","gravatar_id":"","url":"https://api.github.com/users/cboettig","html_url":"https://github.com/cboettig","followers_url":"https://api.github.com/users/cboettig/followers","following_url":"https://api.github.com/users/cboettig/following{/other_user}","gists_url":"https://api.github.com/users/cboettig/gists{/gist_id}","starred_url":"https://api.github.com/users/cboettig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cboettig/subscriptions","organizations_url":"https://api.github.com/users/cboettig/orgs","repos_url":"https://api.github.com/users/cboettig/repos","events_url":"https://api.github.com/users/cboettig/events{/privacy}","received_events_url":"https://api.github.com/users/cboettig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-10T03:35:41Z","updated_at":"2018-05-10T03:35:41Z","body":"@jhpoelen I seem to be getting a 403 access denied error at that URL now(?)","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/387942117/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/388066491","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-388066491","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":388066491,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODA2NjQ5MQ==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-10T14:15:40Z","updated_at":"2018-05-10T14:15:40Z","body":"Thanks for letting me know . I've updated the access privileges and the file should be public now. Please try again - https://depot.globalbioticinteractions.org/tmp/taxon-0.3.2/taxonCache.tsv.gz  .","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/388066491/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/388142512","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-388142512","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":388142512,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODE0MjUxMg==","user":{"login":"cboettig","id":222586,"node_id":"MDQ6VXNlcjIyMjU4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/222586?v=4","gravatar_id":"","url":"https://api.github.com/users/cboettig","html_url":"https://github.com/cboettig","followers_url":"https://api.github.com/users/cboettig/followers","following_url":"https://api.github.com/users/cboettig/following{/other_user}","gists_url":"https://api.github.com/users/cboettig/gists{/gist_id}","starred_url":"https://api.github.com/users/cboettig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cboettig/subscriptions","organizations_url":"https://api.github.com/users/cboettig/orgs","repos_url":"https://api.github.com/users/cboettig/repos","events_url":"https://api.github.com/users/cboettig/events{/privacy}","received_events_url":"https://api.github.com/users/cboettig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-10T18:28:14Z","updated_at":"2018-05-10T18:28:14Z","body":"@jhpoelen Thanks!  Getting there!  Looks like a possible data issue now:\r\n\r\ne.g. row `243356` has a single entry in the path pipe-string but two entries in the pathNames pipe string.  \r\n\r\n```r\r\ntaxonCache <- read_tsv(\"https://depot.globalbioticinteractions.org/tmp/taxon-0.3.2/taxonCache.tsv.gz\", quote=\"\")\r\ntaxonCache[243356,]$path\r\n```\r\n\r\n```\r\n[1] \"Gnaphalium purpureum\"\r\n> taxonCache[243356,]$pathNames\r\n[1] \"kingdom | species\"\r\n```\r\n\r\n\r\nI see a total of 954 records where it looks to me that the number of pipes differs between `path` and `pathName` (though I guess some of these might be `NA` for one or the other, which is guess is okay, but some clearly aren't like the example above).  \r\n\r\n```r\r\npattern <-  \"\\\\s*\\\\|\\\\s*\"\r\npath_pipes <- taxonCache %>% purrr::transpose() %>% \r\n  map_int( ~length(str_split(.x$path, pattern)[[1]]))\r\npathName_pipes <- taxonCache %>% purrr::transpose() %>% \r\n  map_int( ~length(str_split(.x$pathNames, pattern)[[1]]))\r\n\r\n\r\nwhich( !(path_pipes == pathName_pipes))\r\n\r\n```\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/388142512/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/388204013","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-388204013","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":388204013,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODIwNDAxMw==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-10T22:23:18Z","updated_at":"2018-05-10T22:23:18Z","body":"Thanks against for your patience and feedback. \r\n\r\nI went through the entries with mismatching path / path names. I found that most of the issue were due to an historic bug that didn't include empty ranks when ingesting path names. I removed the entries, after spot checking that duplicate entries existed in the taxonCache with aligned path/ids/names. \r\n \r\nA single item, ```EOL:211953\tCetengraulis edentulus``` appear to have a ```\\t``` embedded in common name ```Anchoveta raboamaril\\t3```. It appears that this common name was included in the taxoncache prior to the implementation of tab replacements on writing to tsv. \r\n\r\nThe remaining issues are terms related to non-taxa like environmental terms (e.g., wood) or functional groups (e.g., plankton). These do not have path/rank names. I've included the remaining issue below. \r\n\r\nI've uploaded an updated copy of taxonCache for your review at https://depot.globalbioticinteractions.org/tmp/taxon-0.3.2/taxonCache.tsv.gz .\r\n\r\nThis cleanup of taxonCache.tsv makes me re-realize the importance of data mobility, archiving, versioning, automated quality control, peer review and the effort this all takes... \r\n\r\nid | name | rank | commonNames | path | pathIds | pathNames | externalUrl | thumbnailUrl\r\n-- | -- | -- | -- | -- | -- | -- | -- | --\r\nENVO:00000339 | Stones | NA | NA | environmental feature \\| mesoscopic physical object \\| abiotic mesoscopic physical object \\| piece of rock | ENVO:00002297 \\| ENVO:00002004 \\| ENVO:01000010 \\| ENVO:00000339 | NA | http://purl.obolibrary.org/obo/ENVO_00000339 | NA\r\nENVO:00001998 | soil | NA | NA | environmental material \\| soil | ENVO:00010483 \\| ENVO:00001998 | NA | http://purl.obolibrary.org/obo/ENVO_00001998 | NA\r\nENVO:00002003 | bovine or equine dung | NA | NA | environmental material \\| organic material \\| bodily fluid \\| excreta \\| feces | ENVO:00010483 \\| ENVO:01000155 \\| ENVO:02000019 \\| ENVO:02000022 \\| ENVO:00002003 | NA | http://purl.obolibrary.org/obo/ENVO_00002003 | NA\r\nENVO:00002007 | Sediment | NA | NA | environmental material \\| sediment | ENVO:00010483 \\| ENVO:00002007 | NA | http://purl.obolibrary.org/obo/ENVO_00002007 | NA\r\nENVO:00002040 | Wood | NA | NA | environmental material \\| organic material \\| wood | ENVO:00010483 \\| ENVO:01000155 \\| ENVO:00002040 | NA | http://purl.obolibrary.org/obo/ENVO_00002040 | NA\r\nENVO:01000155 | Detritus | NA | NA | environmental material \\| organic material | ENVO:00010483 \\| ENVO:01000155 | NA | http://purl.obolibrary.org/obo/ENVO_01000155 | NA\r\nENVO:01000404 | plastic | NA | NA | environmental material \\| anthropogenic environmental material | ENVO:00010483 \\| ENVO:0010001 | NA | http://purl.obolibrary.org/obo/ENVO_01000404 | NA\r\nEOL:19662459 | Zooplankton | NA | NA | plankton \\| zooplankton | NA | NA | http://eol.org/pages/19662459 | NA\r\nEOL:19662463 | Phytoplankton | NA | NA | plankton \\| phytoplankton | NA | NA | http://eol.org/pages/19662463 | NA\r\nW:Bacterioplankton | bacterioplankton | NA | NA | plankton \\| bacterioplankton | NA | NA | http://wikipedia.org/wiki/Bacterioplankton | NA\r\nW:Macroalgae | Macroalgae | NA | NA | algae \\| macroalgae | NA | NA | http://wikipedia.org/wiki/Macroalgae | NA\r\n\r\n ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/388204013/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/388415967","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-388415967","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":388415967,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODQxNTk2Nw==","user":{"login":"cboettig","id":222586,"node_id":"MDQ6VXNlcjIyMjU4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/222586?v=4","gravatar_id":"","url":"https://api.github.com/users/cboettig","html_url":"https://github.com/cboettig","followers_url":"https://api.github.com/users/cboettig/followers","following_url":"https://api.github.com/users/cboettig/following{/other_user}","gists_url":"https://api.github.com/users/cboettig/gists{/gist_id}","starred_url":"https://api.github.com/users/cboettig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cboettig/subscriptions","organizations_url":"https://api.github.com/users/cboettig/orgs","repos_url":"https://api.github.com/users/cboettig/repos","events_url":"https://api.github.com/users/cboettig/events{/privacy}","received_events_url":"https://api.github.com/users/cboettig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-11T16:31:50Z","updated_at":"2018-05-11T16:31:50Z","body":"@jhpoelen Found some more rows with alignment / missing-id issue:\r\n\r\nlook for cases with whitespace in the id:\r\n\r\n```r\r\ntaxonCache %>% filter(grepl(\"\\\\s\", id))\r\n```\r\n\r\n(Missed this one before because previously my pattern looked for identifiers with `\"(:|-|_)\"`, and some species names have these in them).  I think it would actually be preferable if ids were all URIs -- would that be possible?  e.g. there's what looks like some UUID strings in there but they don't have the `urn:uuid:` prefix, and some that seem to use `_` as a prefix?\r\n\r\nAnother possible issue I noticed in pathNames:\r\n\r\n```r\r\ntaxonCache %>% filter(grepl(\":\", pathNames))\r\n```\r\n\r\nThis gets the above miss-aligned ones too, but looks like it is mostly getting pathNames given by identifiers, maybe mostly from Wikidata.    I see why wikidata does that so technically these aren't errors, but from a practical point of view it would be much better to have path names we can match to other path names.  e.g. instead of `WD:Q35409 | ...` just have  `family | ...` (as https://www.wikidata.org/wiki/Q35409).  Or maybe that's an issue for a separate thread since it's not really about parsing problem?\r\n\r\n \r\n\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/388415967/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/388519933","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-388519933","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":388519933,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODUxOTkzMw==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-12T01:15:18Z","updated_at":"2018-05-12T01:15:18Z","body":"Thanks!\r\n\r\n> ```taxonCache %>% filter(grepl(\"\\\\s\", id))```\r\nNice! This remove 41 remaining entries with misaligned columns. The accompanying entries with ids were also present in the taxonCache.\r\n\r\n> I think it would actually be preferable if ids were all URIs -- would that be possible?\r\nThat would be possible, and can already by done using a prefix mapping like: https://api.globalbioticinteractions.org/prefixes . You might have noticed that externalUrl expands the id to a resolvable id when possible. \r\n\r\n>e.g. there's what looks like some UUID strings in there but they don't have the urn:uuid: prefix, and some that seem to use _ as a prefix?\r\nGood point. Please note that #6 describes the origin of the prefix-less ids. I am hoping to incorporate these changes in the next major release of GloBI's taxon graph (should I rename to globi term graph instead?). I've started making manual patches using a development version and nomer, only to release that my time is probably better spent on thinking more about how to automatically validate, and report on, term mappings in addition to making the term graph more modular (e.g., splitting up term vertices and mapping edges into more manageable chunks similar to modular development of software libraries). If this is a big concern, please let me know. \r\n\r\n> ```taxonCache %>% filter(grepl(\":\", pathNames))```\r\nThis additional validator only selected the wikidata path names. As you noticed, abbreviated wikidata identifiers were used to capture the rank information. This was done for pragmatic reasons. It should be relatively easy to map the rank name ids to associated labels. In the future, we might want to introduce a normalized term rank by introducing rankName and rankId, in addition to pathNames and pathNameIds. Related to  #7 . \r\n\r\nI've prepared https://depot.globalbioticinteractions.org/tmp/taxon-0.3.2/taxonCache.tsv.gz  for your review. If you are ok with this version, I'll prepare another zenodo publication. Otherwise, please detail your concerns.\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/388519933/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/388567847","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-388567847","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":388567847,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODU2Nzg0Nw==","user":{"login":"cboettig","id":222586,"node_id":"MDQ6VXNlcjIyMjU4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/222586?v=4","gravatar_id":"","url":"https://api.github.com/users/cboettig","html_url":"https://github.com/cboettig","followers_url":"https://api.github.com/users/cboettig/followers","following_url":"https://api.github.com/users/cboettig/following{/other_user}","gists_url":"https://api.github.com/users/cboettig/gists{/gist_id}","starred_url":"https://api.github.com/users/cboettig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cboettig/subscriptions","organizations_url":"https://api.github.com/users/cboettig/orgs","repos_url":"https://api.github.com/users/cboettig/repos","events_url":"https://api.github.com/users/cboettig/events{/privacy}","received_events_url":"https://api.github.com/users/cboettig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-12T16:47:46Z","updated_at":"2018-05-12T16:47:46Z","body":"> Please note that #6 describes the origin of the prefix-less ids. I am hoping to incorporate these changes in the next major release of GloBI's taxon graph (should I rename to globi term graph instead?). I've started making manual patches using a development version and nomer, only to release that my time is probably better spent on thinking more about how to automatically validate, and report on, term mappings in addition to making the term graph more modular (e.g., splitting up term vertices and mapping edges into more manageable chunks similar to modular development of software libraries). If this is a big concern, please let me know.\r\n\r\nSounds like a plan.  Nice to have ALA taxon addressed. I'm still seeing 57 rows that don't have a `:` in the `id`, e.g. \r\n\r\n```r\r\n> taxonCache %>% filter(!grepl(\":\", id))\r\n# A tibble: 57 x 9\r\n   id                                   name   rank  commonNames path  pathIds pathNames externalUrl thumbnailUrl\r\n   <chr>                                <chr>  <chr> <chr>       <chr> <chr>   <chr>     <chr>       <chr>       \r\n 1 4701dc84-660a-4c51-bd16-593997f2370b Coelo… spec… NA          Fung… urn:ls… kingdom … NA          NA          \r\n 2 ALA_Cladia_muelleri                  Cladi… unkn… NA          | Cl… | ALA_… | unknown NA          NA          \r\n 3 ALA_Delia_hirticrura                 Delia… unkn… NA          | De… | ALA_… | unknown NA          NA          \r\n 4 ALA_Oxycetonia_jucunda               Oxyce… unkn… NA          | Ox… | ALA_… | unknown NA          NA          \r\n 5 NZOR-3-100527                        Proci… genus NA          | Pr… | NZOR… | genus   NA          NA          \r\n 6 NZOR-3-109825                        Marie… genus NA          | Ma… | NZOR… | genus   NA          NA          \r\n 7 NZOR-3-33834                         Misce… unkn… NA          | Mi… | NZOR… | unknown NA          NA          \r\n 8 NZOR-3-40069                         Proka… unkn… NA          | Pr… | NZOR… | unknown NA          NA          \r\n 9 NZOR-3-41136                         Urtic… genus NA          | Ur… | NZOR… | genus   NA          NA          \r\n10 NZOR-3-54695                         Oreoc… genus NA          | Or… | NZOR… | genus   NA          NA          \r\n# ... with 47 more rows\r\n````\r\nMaybe that is intentional?  Isn't clear if these identifiers can be resolved, notably they have no externalUrl entry, though `ALA` and `NZOR` look like they want to be prefixes to something(?)\r\n\r\n\r\nThere's a larger set of things with no externalUrl, some which seem to have prefixes that aren't defined in the prefix table (`CoL`, `CAAB`, ...), e.g.:\r\n\r\n```r\r\n> taxonCache %>% filter(is.na(externalUrl))\r\n# A tibble: 2,770 x 9\r\n   id       name    rank  commonNames path         pathIds                  pathNames    externalUrl thumbnailUrl\r\n   <chr>    <chr>   <chr> <chr>       <chr>        <chr>                    <chr>        <chr>       <chr>       \r\n 1 4701dc8… Coelom… spec… NA          Fungi | Chy… urn:lsid:indexfungorum.… kingdom | p… NA          NA          \r\n 2 ALA_Cla… Cladia… unkn… NA          | Cladia mu… | ALA_Cladia_muelleri    | unknown    NA          NA          \r\n 3 ALA_Del… Delia … unkn… NA          | Delia hir… | ALA_Delia_hirticrura   | unknown    NA          NA          \r\n 4 ALA_Oxy… Oxycet… unkn… NA          | Oxycetoni… | ALA_Oxycetonia_jucunda | unknown    NA          NA          \r\n 5 CAAB:0c… Halica… spec… NA          Halicarcinu… CAAB:0cd18290:475549ca:… species      NA          NA          \r\n 6 CAAB:23… Taloch… spec… NA          | Talochlam… | CAAB:23270067          | species    NA          NA          \r\n 7 CAAB:28… Crab z… unkn… NA          | Crab zoea  | CAAB:28850902          | unknown    NA          NA          \r\n 8 CAAB:53… Mastog… spec… NA          Mastogloiac… CAAB:53210000 | CAAB:53… family | ge… NA          NA          \r\n 9 CAAB:80… Microa… unkn… microalgae… | Microalgae | CAAB:80200000          | unknown    NA          NA          \r\n10 CoL:254… Pseudo… spec… NA          Pseudoparre… CoL:25759155 | CoL:2549… genus | spe… NA          NA          \r\n# ... with 2,760 more rows\r\n```\r\n\r\nAgain, I think this all just shows what an amazing resource this is to have all of this compiled in a nice file like `taxonCache.tsv.gz`, as synthesizing all these resources in a single table like that is far from trivial!  \r\n\r\nRunning a few experiments on the pipe paths but I think that all relates to next steps in #7 rather than possible issues in `taxonCache`.  Lemme know what you think about the above concerns with some of the `ids` bot otherwise this is looking ready for release to me. \r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/388567847/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/388693188","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-388693188","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":388693188,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODY5MzE4OA==","user":{"login":"cboettig","id":222586,"node_id":"MDQ6VXNlcjIyMjU4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/222586?v=4","gravatar_id":"","url":"https://api.github.com/users/cboettig","html_url":"https://github.com/cboettig","followers_url":"https://api.github.com/users/cboettig/followers","following_url":"https://api.github.com/users/cboettig/following{/other_user}","gists_url":"https://api.github.com/users/cboettig/gists{/gist_id}","starred_url":"https://api.github.com/users/cboettig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cboettig/subscriptions","organizations_url":"https://api.github.com/users/cboettig/orgs","repos_url":"https://api.github.com/users/cboettig/repos","events_url":"https://api.github.com/users/cboettig/events{/privacy}","received_events_url":"https://api.github.com/users/cboettig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-14T04:22:54Z","updated_at":"2018-05-14T04:22:54Z","body":"\r\nLooks like there might be a few cases where path, pathNames, and pathIDs do not all have the same length (not counting cases where any one of these is na).  e.g. row with id = `ITIS:10824`.  Could be indicative of an issue?\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/388693188/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/389005205","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-389005205","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":389005205,"node_id":"MDEyOklzc3VlQ29tbWVudDM4OTAwNTIwNQ==","user":{"login":"cboettig","id":222586,"node_id":"MDQ6VXNlcjIyMjU4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/222586?v=4","gravatar_id":"","url":"https://api.github.com/users/cboettig","html_url":"https://github.com/cboettig","followers_url":"https://api.github.com/users/cboettig/followers","following_url":"https://api.github.com/users/cboettig/following{/other_user}","gists_url":"https://api.github.com/users/cboettig/gists{/gist_id}","starred_url":"https://api.github.com/users/cboettig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cboettig/subscriptions","organizations_url":"https://api.github.com/users/cboettig/orgs","repos_url":"https://api.github.com/users/cboettig/repos","events_url":"https://api.github.com/users/cboettig/events{/privacy}","received_events_url":"https://api.github.com/users/cboettig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-15T00:34:48Z","updated_at":"2018-05-15T00:34:48Z","body":"in case it's at all helpful, here's the crummy R code I'm using to identify the ~1000 rows that appear to have issues.   \r\n\r\n```r\r\n## Expect same number of pipes in each entry:\r\npattern = \"\\\\s*\\\\|\\\\s*\"\r\npath_pipes <- taxonCache %>% purrr::transpose() %>% map_int( ~length(str_split(.x$path, pattern)[[1]]))\r\npathName_pipes <- taxonCache %>% purrr::transpose() %>% map_int( ~length(str_split(.x$pathNames, pattern)[[1]]))\r\npathIds_pipes <- taxonCache %>% purrr::transpose() %>% map_int( ~length(str_split(.x$pathIds, pattern)[[1]]))\r\nna_path <- is.na(taxonCache$path)\r\nna_pathNames <- is.na(taxonCache$pathNames)\r\nna_pathIds  <- is.na(taxonCache$pathIds)\r\n\r\ntrouble <- which( !(pathIds_pipes == path_pipes) & !na_path & !na_pathIds)\r\n\r\n## Here's the ~1000 rows that appear miss-matched to me\r\ntaxonCache[trouble,]\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/389005205/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/389010000","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-389010000","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":389010000,"node_id":"MDEyOklzc3VlQ29tbWVudDM4OTAxMDAwMA==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-15T01:07:23Z","updated_at":"2018-05-15T01:07:23Z","body":"Very helpful indeed, thank for being thorough I am working on an input / output validation framework to more easily detect these inconsistencies. #8 . Curious to hear your thoughts on that. ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/389010000/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/390851446","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-390851446","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":390851446,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MDg1MTQ0Ng==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-05-22T03:27:55Z","updated_at":"2018-05-22T03:27:55Z","body":"@cboettig just published http://doi.org/10.5281/zenodo.1250572 . In this version, consistency terms and links were checked using nomer's ```validate-term``` and ```validate-term-link```.  Also, various fixes were included to help make the ids and their hierarchies a bit more well-behaved.  ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/390851446/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/395989117","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-395989117","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":395989117,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NTk4OTExNw==","user":{"login":"cboettig","id":222586,"node_id":"MDQ6VXNlcjIyMjU4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/222586?v=4","gravatar_id":"","url":"https://api.github.com/users/cboettig","html_url":"https://github.com/cboettig","followers_url":"https://api.github.com/users/cboettig/followers","following_url":"https://api.github.com/users/cboettig/following{/other_user}","gists_url":"https://api.github.com/users/cboettig/gists{/gist_id}","starred_url":"https://api.github.com/users/cboettig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cboettig/subscriptions","organizations_url":"https://api.github.com/users/cboettig/orgs","repos_url":"https://api.github.com/users/cboettig/repos","events_url":"https://api.github.com/users/cboettig/events{/privacy}","received_events_url":"https://api.github.com/users/cboettig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-06-09T18:19:42Z","updated_at":"2020-03-12T00:36:19Z","body":"@jhpoelen Maybe I'm not understanding something here, but it seems there's ~ 500,000 rows in taxonCache involving duplicate ids?\r\n\r\nI think this should be reproducible R code:\r\n\r\n```r\r\nlibrary(tidyverse)\r\ntaxonCache <- read_tsv(\"https://zenodo.org/record/1250572/files/taxonCache.tsv.gz\", quote=\"\")\r\n\r\ndup_id <- \r\n  taxonCache %>% select(id) %>% group_by(id) %>% \r\n  summarise(n_id = length(id)) %>% filter(n_id > 1) \r\n\r\ntrouble <- taxonCache %>% semi_join(select(dup_id, id))\r\n\r\n# a data frame with the subset of taxonCache having duplicate ids\r\ntrouble\r\n```\r\n\r\nThis prevents me from establishing a unique path / pathId / pathNames for an ID; it's not clear how to resolve the conflicts.  I think this is related (/the cause of) to the issue I just added to #7 \r\n\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/395989117/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/395993512","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-395993512","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":395993512,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NTk5MzUxMg==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-06-09T19:37:19Z","updated_at":"2018-06-09T19:37:19Z","body":"@cboettig thanks for sharing. See https://github.com/globalbioticinteractions/nomer/issues/7#issuecomment-395992615 . I think this warrants a further discussion. . . ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/395993512/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/398224456","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-398224456","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":398224456,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODIyNDQ1Ng==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-06-18T23:15:57Z","updated_at":"2018-06-18T23:15:57Z","body":"Also, please note https://github.com/globalbioticinteractions/nomer/issues/9 - would having the name source / retrieval date would provide more information on which taxon id to select?\r\n\r\nCurrently, GloBI itself uses a pretty blunt method - just use all that match to populate taxon search index/ graph. ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/398224456/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/597956495","html_url":"https://github.com/globalbioticinteractions/nomer/issues/5#issuecomment-597956495","issue_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/5","id":597956495,"node_id":"MDEyOklzc3VlQ29tbWVudDU5Nzk1NjQ5NQ==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-03-12T01:10:04Z","updated_at":"2020-03-12T01:10:04Z","body":"Here's an example of a taxon id with slight changes in name hierarchies as provided by the name source. Note that http://id.biodiversity.org.au/node/apni/50587232 and https://id.biodiversity.org.au/taxon/apni/51337710 are both outdated identifiers for Plantae. So, this is an example of multiple interpretations of taxon ids. \r\n\r\nAm leaving this issue open because it exposes some interesting effects associated to taxon ids.\r\n\r\n\r\nid | name | rank | commonNames | path | pathIds | pathNames | externalUrl | thumbnailUrl\r\n-- | -- | -- | -- | -- | -- | -- | -- | --\r\nALATaxon:NZOR-6-102447 | Eurya | genus |   | Plantae \\| Charophyta \\| Equisetopsida \\| Magnoliidae \\| Ericales \\| Pentaphylacaceae \\| Eurya | ALATaxon:http://id.biodiversity.org.au/node/apni/50587232 \\| ALATaxon:http://id.biodiversity.org.au/node/apni/50587231 \\| ALATaxon:http://id.biodiversity.org.au/node/apni/50587230 \\| ALATaxon:http://id.biodiversity.org.au/node/apni/50587229 \\| ALATaxon:http://id.biodiversity.org.au/node/apni/8790835 \\| ALATaxon:http://id.biodiversity.org.au/node/apni/8305023 \\| ALATaxon:NZOR-6-102447 | kingdom \\| phylum \\| class \\| subclass \\| order \\| family \\| genus | https://bie.ala.org.au/species/NZOR-6-102447 |  \r\nALATaxon:NZOR-6-102447 | Eurya | genus |   | Plantae \\| Charophyta \\| Equisetopsida \\| Magnoliidae \\| Ericales \\| Pentaphylacaceae \\| Eurya | ALATaxon:https://id.biodiversity.org.au/taxon/apni/51337710 \\| ALATaxon:https://id.biodiversity.org.au/taxon/apni/51337706 \\| ALATaxon:https://id.biodiversity.org.au/taxon/apni/51337705 \\| ALATaxon:https://id.biodiversity.org.au/taxon/apni/51337515 \\| ALATaxon:https://id.biodiversity.org.au/taxon/apni/51311074 \\| ALATaxon:https://id.biodiversity.org.au/node/apni/8305023 \\| ALATaxon:NZOR-6-102447 | kingdom \\| phylum \\| class \\| subclass \\| order \\| family \\| genus | https://bie.ala.org.au/species/NZOR-6-102447 |  ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/comments/597956495/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]