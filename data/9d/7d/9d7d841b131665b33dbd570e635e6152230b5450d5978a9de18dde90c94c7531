{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/19","repository_url":"https://api.github.com/repos/globalbioticinteractions/nomer","labels_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/19/labels{/name}","comments_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/19/comments","events_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/19/events","html_url":"https://github.com/globalbioticinteractions/nomer/issues/19","id":622018057,"node_id":"MDU6SXNzdWU2MjIwMTgwNTc=","number":19,"title":"unexpected error when using two nomer processes with one cache directory","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-05-20T19:06:38Z","updated_at":"2020-05-20T20:56:13Z","closed_at":"2020-05-20T20:56:13Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Nomer uses internal index/caches (in ```.nomer``` directory) to enable fast offline term matching.\r\n\r\nOn using two Nomer instances on a non-indexed system, the exception (```java.io.IOError: java.io.IOException: Wrong index checksum, store was not closed properly and could be corrupted.```) was observed. \r\n\r\nRoot cause was a new index created by the first Nomer instance with un-commited changes was being re-use by a second Nomer instance.\r\n\r\nSuggested fix is to explicitly commit changes after created a new index and to prevent overwriting of existing (partial) indexes. \r\n\r\n```\r\n$ zcat target/taxonCacheNoHeader.tsv.gz | tail -n +2 | cut -f3 | awk -F '\\t' '{ print $1 \"\\t\" $1 }' | java -jar target/nomer.jar replace --properties=config/name2id.properties globi-taxon-rank | cut -f1 | java -jar target/nomer.jar replace --properties=config/id2name.properties globi-taxon-rank | pv -l > testing123\r\nusing matcher [globi-taxon-rank]\r\nusing matcher [globi-taxon-rank]\r\nInvalid cookie header: \"Set-Cookie: WMF-Last-Access=20-May-2020;Path=/;HttpOnly;secure;Expires=Sun, 21 Jun 2020 12:00:00 GMT\". Invalid 'expires' attribute: Sun, 21 Jun 2020 12:00:00 GMT\r\nInvalid cookie header: \"Set-Cookie: WMF-Last-Access-Global=20-May-2020;Path=/;Domain=.wikidata.org;HttpOnly;secure;Expires=Sun, 21 Jun 2020 12:00:00 GMT\". Invalid 'expires' attribute: Sun, 21 Jun 2020 12:00:00 GMT\r\nInvalid cookie header: \"Set-Cookie: WMF-Last-Access=20-May-2020;Path=/;HttpOnly;secure;Expires=Sun, 21 Jun 2020 12:00:00 GMT\". Invalid 'expires' attribute: Sun, 21 Jun 2020 12:00:00 GMT\r\nInvalid cookie header: \"Set-Cookie: WMF-Last-Access-Global=20-May-2020;Path=/;Domain=.wikidata.org;HttpOnly;secure;Expires=Sun, 21 Jun 2020 12:00:00 GMT\". Invalid 'expires' attribute: Sun, 21 Jun 2020 12:00:00 GMT\r\nlocal taxon cache of [file:/home/jhpoelen/taxon-graph-builder/./.nomer/wikidata_appended_taxon_ranks.tsv] building...\r\ncache with [100] items built in [0.0] s or [5000.0] items/s.\r\nlocal taxon cache of [file:/home/jhpoelen/taxon-graph-builder/./.nomer/wikidata_appended_taxon_ranks.tsv] built.\r\nlocal taxon map of [file:/home/jhpoelen/taxon-graph-builder/./.nomer/wikidata_appended_taxon_rank_links.tsv] building...\r\ncache with [7215] items built in [0.1] s or [49417.8] items/s.\r\nlocal taxon map of [file:/home/jhpoelen/taxon-graph-builder/./.nomer/wikidata_appended_taxon_rank_links.tsv] built.\r\nunexpected exception/s] [<=>                                                   ]\r\njava.io.IOError: java.io.IOException: Wrong index checksum, store was not closed properly and could be corrupted.\r\n\tat org.mapdb.StoreDirect.checkHeaders(StoreDirect.java:269)\r\n\tat org.mapdb.StoreDirect.<init>(StoreDirect.java:207)\r\n\tat org.mapdb.DBMaker.extendStoreDirect(DBMaker.java:971)\r\n\tat org.mapdb.DBMaker.makeEngine(DBMaker.java:758)\r\n\tat org.mapdb.DBMaker.make(DBMaker.java:701)\r\n\tat org.eol.globi.service.CacheService.initDb(CacheService.java:35)\r\n\tat org.eol.globi.taxon.TaxonCacheService.initTaxonCache(TaxonCacheService.java:166)\r\n\tat org.eol.globi.taxon.TaxonCacheService.init(TaxonCacheService.java:121)\r\n\tat org.eol.globi.taxon.TaxonCacheService.lazyInit(TaxonCacheService.java:116)\r\n\tat org.eol.globi.taxon.TaxonCacheService.match(TaxonCacheService.java:202)\r\n\tat org.eol.globi.service.TermMatcherHierarchical.match(TermMatcherHierarchical.java:57)\r\n\tat org.globalbioticinteractions.nomer.util.ReplacingRowHandler.onRow(ReplacingRowHandler.java:101)\r\n\tat org.globalbioticinteractions.nomer.util.MatchUtil.apply(MatchUtil.java:52)\r\n\tat org.globalbioticinteractions.nomer.util.MatchUtil.match(MatchUtil.java:26)\r\n\tat org.globalbioticinteractions.nomer.cmd.CmdReplace.run(CmdReplace.java:17)\r\n\tat org.globalbioticinteractions.nomer.cmd.CmdLine.run(CmdLine.java:18)\r\n\tat org.globalbioticinteractions.nomer.cmd.CmdLine.run(CmdLine.java:27)\r\n\tat org.globalbioticinteractions.nomer.Nomer.main(Nomer.java:15)\r\nCaused by: java.io.IOException: Wrong index checksum, store was not closed properly and could be corrupted.\r\n\t... 18 more\r\n```","closed_by":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/19/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/globalbioticinteractions/nomer/issues/19/timeline","performed_via_github_app":null,"state_reason":"completed"}